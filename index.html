<!doctype html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, minimum-scale=1, maximum-scale=1">
  <title>Balatro</title>
  <base href="https://cdn.jsdelivr.net/gh/swebsites469-bit/T0Xpyt3ZAuXUgZiPfnBy7IKynVVeKY7q/">
  <!-- Load custom style sheet -->
  <link rel="stylesheet" type="text/css" href="theme/love.css">

  <script src="consolewrapper.js"></script>
  <script>
    if (typeof console !== 'undefined' && typeof console.debug !== 'function') {
      console.debug = console.log.bind(console);
    }
    var __logger = (typeof console !== 'undefined') ? console : null;
    if (typeof window !== 'undefined') {
      if (typeof window.__getWebDB !== 'function') {
        window.__getWebDB = function(name) {
          try {
            return window.localStorage ? window.localStorage.getItem(name) : null;
          } catch (err) {
            if (__logger && __logger.warn) {
              __logger.warn('Unable to access localStorage for __getWebDB:', err);
            }
            return null;
          }
        };
      }
      if (typeof window.__setWebDB !== 'function') {
        window.__setWebDB = function(name, value) {
          try {
            if (window.localStorage) {
              window.localStorage.setItem(name, value);
              return true;
            }
          } catch (err) {
            if (__logger && __logger.warn) {
              __logger.warn('Unable to access localStorage for __setWebDB:', err);
            }
          }
          return false;
        };
      }
    }
  </script>
</head>

<body>
  <center>
    <div>
      <!-- <h1>Balatro</h1> -->
      <canvas id="loadingCanvas" oncontextmenu="event.preventDefault()" width="800" height="600"></canvas>
      <canvas id="canvas" oncontextmenu="event.preventDefault()" width="100%" height="100%"></canvas>
    </div>
  </center>

  <script type='text/javascript'>
    window.callad = () => {
      window.parent.postMessage({
        type: 'adcall'
      }, '*');
    }
    var canvas = document.getElementById("loadingCanvas");
    canvas.width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    canvas.height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

    function goFullScreen() {
      var canvas = document.getElementById("canvas");
      if (canvas.requestFullScreen)
        canvas.requestFullScreen();
      else if (canvas.webkitRequestFullScreen)
        canvas.webkitRequestFullScreen();
      else if (canvas.mozRequestFullScreen)
        canvas.mozRequestFullScreen();
    }

    function FullScreenHook() {
      var canvas = document.getElementById("canvas");
      canvas.width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
      canvas.height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
    }
    var loadingContext = document.getElementById('loadingCanvas').getContext('2d');

    function drawLoadingText(text) {
      var canvas = loadingContext.canvas;

      loadingContext.fillStyle = "rgb(142, 195, 227)";
      loadingContext.fillRect(0, 0, canvas.scrollWidth, canvas.scrollHeight);

      loadingContext.font = '2em arial';
      loadingContext.textAlign = 'center'
      loadingContext.fillStyle = "rgb( 11, 86, 117 )";
      loadingContext.fillText(text, canvas.scrollWidth / 2, canvas.scrollHeight / 2);

      // loadingContext.fillText("Powered By Emscripten.", canvas.scrollWidth / 2, canvas.scrollHeight / 4);
      // loadingContext.fillText("Powered By LÃ–VE.", canvas.scrollWidth / 2, canvas.scrollHeight / 4 * 3);
    }

    window.onload = function() {
      window.focus();
    };
    window.onclick = function() {
      window.focus();
    };

    window.addEventListener("keydown", function(e) {
      // space and arrow keys
      if ([32, 37, 38, 39, 40].indexOf(e.keyCode) > -1) {
        e.preventDefault();
      }
    }, false);

    var Module = {
      arguments: ["./data"],
      INITIAL_MEMORY: 256000000,
      printErr: console.error.bind(console),
      canvas: (function() {
        var canvas = document.getElementById('canvas');

        // As a default initial behavior, pop up an alert when webgl context is lost. To make your
        // application robust, you may want to override this behavior before shipping!
        // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
        canvas.addEventListener("webglcontextlost", function(e) {
          alert('WebGL context lost. You will need to reload the page.');
          e.preventDefault();
        }, false);

        return canvas;
      })(),
      setStatus: function(text) {
        if (text) {
          drawLoadingText(text);
        } else if (Module.remainingDependencies === 0) {
          document.getElementById('loadingCanvas').style.display = 'none';
          document.getElementById('canvas').style.visibility = 'visible';
        }
      },
      totalDependencies: 0,
      remainingDependencies: 0,
      monitorRunDependencies: function(left) {
        this.remainingDependencies = left;
        this.totalDependencies = Math.max(this.totalDependencies, left);
        Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
      }
    };
    Module.setStatus('Downloading...');
    window.onerror = function(event) {
      // TODO: do not warn on ok events like simulating an infinite loop or exitStatus
      Module.setStatus('Exception thrown, see JavaScript console');
      Module.setStatus = function(text) {
        if (text) Module.printErr('[post-exception status] ' + text);
      };
    };

    var applicationLoad = function(e) {
      Love(Module);
    }
  </script>
  <script type="text/javascript" src="game.js"></script>
  <script async type="text/javascript" src="love.js" onload="applicationLoad(this)"></script>
  <!-- <footer>
      <p>Built with <a href="https://github.com/Davidobot/love.js">love.js</a> <button onclick="goFullScreen();">Go Fullscreen</button><br>Hint: Reload the page if screen is blank</p>
    </footer> -->
    <script src="announcements.js"></script>
<script>
(async () => {

///////////////////////////////
// ðŸ”¥ PRESS I TO TOGGLE MENU
///////////////////////////////
window.addEventListener("keydown", (e) => {
if (e.key.toLowerCase() === "i") {
menu.style.display = (menu.style.display === "none") ? "block" : "none";
}
});

///////////////////////////////
// ðŸ”¥ BUILD FLOATING MENU UI
///////////////////////////////
const menu = document.createElement("div");
Object.assign(menu.style, {
position: "fixed",
top: "20px",
right: "20px",
padding: "12px",
background: "rgba(30,30,30,0.95)",
color: "white",
border: "1px solid #555",
borderRadius: "8px",
zIndex: "999999",
fontFamily: "Arial",
width: "180px",
display: "none"
});
menu.innerHTML = `
<b>Unity Save Tools</b><br><br>
<button id="idb_export" style="width:100%;margin-bottom:6px;">Export</button>
<button id="idb_import" style="width:100%;">Import</button>
`;
document.body.appendChild(menu);

///////////////////////////////
// ðŸ”¥ BASE64 HELPERS
///////////////////////////////
function bytesToBase64(bytes) {
let binary = "";
bytes = new Uint8Array(bytes);
for (let i = 0; i < bytes.length; i++) {
binary += String.fromCharCode(bytes[i]);
}
return btoa(binary);
}

function base64ToBytes(b64) {
const binary = atob(b64);
const bytes = new Uint8Array(binary.length);
for (let i = 0; i < binary.length; i++) {
bytes[i] = binary.charCodeAt(i);
}
return bytes;
}

///////////////////////////////
// ðŸ”¥ EXPORT (DUMP)
///////////////////////////////
async function dumpIDBFS() {
const dbs = await indexedDB.databases();
let output = {};

for (const dbInfo of dbs) {
if (!dbInfo.name) continue;

await new Promise((resolve) => {
const req = indexedDB.open(dbInfo.name);

req.onerror = resolve;
req.onupgradeneeded = resolve;

req.onsuccess = (ev) => {
const db = ev.target.result;
output[dbInfo.name] = { version: dbInfo.version, stores: {} };

const storeNames = Array.from(db.objectStoreNames);
if (storeNames.length === 0) {
db.close();
return resolve();
}

let remaining = storeNames.length;

storeNames.forEach(storeName => {
const tx = db.transaction(storeName, "readonly");
const store = tx.objectStore(storeName);
const reqAll = store.getAll();

reqAll.onsuccess = () => {
output[dbInfo.name].stores[storeName] = reqAll.result.map(obj => {
let copy = {...obj};
if (copy.contents instanceof ArrayBuffer || ArrayBuffer.isView(copy.contents)) {
copy.contents = bytesToBase64(copy.contents);
copy.__binary = true;
}
return copy;
});

if (--remaining === 0) {
db.close();
resolve();
}
};
});
};
});
}

const blob = new Blob([JSON.stringify(output, null, 2)], {type:"application/json"});
const url = URL.createObjectURL(blob);
const a = document.createElement("a");
a.href = url;
a.download = "unity_idbfs_dump.json";
a.click();
URL.revokeObjectURL(url);
}

///////////////////////////////
// ðŸ”¥ IMPORT (RESTORE)
///////////////////////////////
async function restoreIDBFS(json) {
for (const [dbName, dbData] of Object.entries(json)) {
const version = dbData.version || 1;

// delete old DB
await new Promise((resolve) => {
const del = indexedDB.deleteDatabase(dbName);
del.onerror = resolve;
del.onsuccess = resolve;
del.onblocked = resolve;
});

// recreate DB
await new Promise((resolve) => {
const req = indexedDB.open(dbName, version);

req.onupgradeneeded = (ev) => {
const db = ev.target.result;
for (const storeName of Object.keys(dbData.stores)) {
if (!db.objectStoreNames.contains(storeName)) {
db.createObjectStore(storeName, { autoIncrement: true });
}
}
};

req.onsuccess = (ev) => {
const db = ev.target.result;
const storeNames = Object.keys(dbData.stores);
let remaining = storeNames.length;

if (remaining === 0) {
db.close();
return resolve();
}

storeNames.forEach(storeName => {
const tx = db.transaction(storeName, "readwrite");
const store = tx.objectStore(storeName);

dbData.stores[storeName].forEach(record => {
let obj = {...record};
if (obj.__binary) {
obj.contents = base64ToBytes(obj.contents);
delete obj.__binary;
}
store.add(obj);
});

tx.oncomplete = () => {
if (--remaining === 0) {
db.close();
resolve();
}
};
});
};
});
}

alert("Restore complete. Reload the page.");
}

///////////////////////////////
// ðŸ”¥ CONNECT MENU BUTTONS
///////////////////////////////
document.getElementById("idb_export").onclick = dumpIDBFS;

document.getElementById("idb_import").onclick = () => {
const input = document.createElement("input");
input.type = "file";
input.accept = "application/json";
input.onchange = async (e) => {
const file = e.target.files[0];
if (!file) return;
const text = await file.text();
const data = JSON.parse(text);
await restoreIDBFS(data);
};
input.click();
};

})();
</script>
</body>
</html>









